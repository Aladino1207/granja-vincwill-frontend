<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Granja Av√≠cola VincWill - Configuraci√≥n</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div style="display: flex; align-items: center; gap: 15px;">
            <img src="" class="app-logo-img" alt="Logo" style="max-height: 40px;">
            <h1 id="pageTitle">Dashboard</h1>
        </div>
        <div class="user-profile-container">
            <div id="userMenuBtn" class="user-avatar-btn" title="Men√∫ de Usuario">
                <span id="userInitials">U</span>
            </div>

            <div id="userDropdown" class="user-dropdown-menu">

                <div class="dropdown-header">
                    <div class="dropdown-avatar-large">
                        <span id="dropdownInitials">U</span>
                    </div>
                    <div class="dropdown-user-info">
                        <h4 id="dropdownName">Cargando...</h4>
                        <p id="dropdownBranch">Cargando...</p>
                    </div>
                </div>

                <ul class="dropdown-actions">
                    <li>
                        <button id="changeBranchBtn" class="dropdown-item">
                            üîÑ Cambiar Almac√©n
                        </button>
                    </li>
                    <li>
                        <button onclick="logout()" class="dropdown-item logout-item">
                            üö™ Cerrar Sesi√≥n
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <aside class="sidebar">
        <nav>
            <div class="nav-group nav-group-main">
                <div class="nav-links-container">
                    <a href="index.html" class="nav-link">Dashboard</a>
                </div>
            </div>

            <div class="nav-group">
                <h4 class="nav-category-title" data-target="#operaciones-links">Operaciones</h4>
                <div class="nav-links-container" id="operaciones-links">
                    <a href="galpones.html" class="nav-link">Galpones</a>
                    <a href="lotes.html" class="nav-link">Lotes</a>
                    <a href="inventarios.html" class="nav-link">Inventario</a>
                    <a href="agua.html" class="nav-link">Agua</a>
                    <a href="salud.html" class="nav-link">Salud</a>
                    <a href="seguimiento.html" class="nav-link">Seguimiento</a>

                </div>
            </div>

            <div class="nav-group">
                <h4 class="nav-category-title" data-target="#finanzas-links">Finanzas</h4>
                <div class="nav-links-container" id="finanzas-links">
                    <a href="clientes.html" class="nav-link">Clientes</a>
                    <a href="proveedores.html" class="nav-link">Proveedores</a>
                    <a href="ventas.html" class="nav-link">Ventas</a>
                    <a href="costos.html" class="nav-link">Costos</a>
                    <a href="reportes.html" class="nav-link">Reportes</a>
                </div>
            </div>

            <div class="nav-group">
                <h4 class="nav-category-title" data-target="#admin-links">Administraci√≥n</h4>
                <div class="nav-links-container" id="admin-links">
                    <a href="usuarios.html" class="nav-link">Usuarios y Granjas</a>
                    <a href="configuracion.html" class="nav-link">Configuraci√≥n</a>
                </div>
            </div>
        </nav>
    </aside>

    <main class="main-content">

        <section class="card">
            <h2>Ajustes Generales</h2>
            <form id="configForm" class="form-grid form-grid-3-col">
                <div class="form-group">
                    <label for="nombreGranja">Nombre de la Granja</label>
                    <input type="text" id="nombreGranja" class="form-control">
                </div>

                <!-- NUEVO CAMPO LOGO -->
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="logoInput">Logo de la Empresa</label>

                    <input type="file" id="logoInput" class="form-control" accept="image/*">

                    <input type="hidden" id="logoBase64">

                    <small style="color: #666;">Formatos: PNG, JPG. M√°x 2MB recomendado.</small>

                    <div style="margin-top: 10px; padding: 10px; border: 1px dashed #ccc; text-align: center;">
                        <p style="margin:0 0 5px 0; font-size: 0.8rem;">Vista Previa:</p>
                        <img id="logoPreview" src="" alt="Sin Logo"
                            style="max-height: 80px; max-width: 100%; display: none;">
                    </div>
                </div>

                <div class="form-group">
                    <label for="notificaciones">Notificaciones</label>
                    <select id="notificaciones" class="form-control">
                        <option value="Activadas">Activadas</option>
                        <option value="Desactivadas">Desactivadas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="idioma">Idioma</label>
                    <select id="idioma" class="form-control">
                        <option value="Espa√±ol">Espa√±ol</option>
                        <option value="Ingl√©s">Ingl√©s</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nombreGranja">Nombre de la Granja</label>
                    <input type="text" id="nombreGranja" class="form-control">
                </div>

                <!-- NUEVO CAMPO V 4.2 -->
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="planVacunacion">Plan Sanitario por Defecto (D√≠as)</label>
                    <input type="text" id="planVacunacion" class="form-control" placeholder="Ej: 7, 14, 21, 35">
                    <small style="color: #666;">
                        D√≠as despu√©s del ingreso del lote en los que se crear√°n recordatorios autom√°ticos.
                    </small>
                </div>

                <div class="form-group" style="grid-column: 1 / -1;">
                    <button type="submit" class="btn btn-primario">Guardar Ajustes</button>
                </div>
            </form>
        </section>

        <section class="card">
            <h2>Programaci√≥n de Vacunaci√≥n y Tareas</h2>
            <p style="color: #666; margin-bottom: 1rem;">
                Agrega aqu√≠ tus recordatorios manuales (Ej: "Vacunar Lote 001").
                Aparecer√°n en el calendario del Dashboard.
            </p>

            <form id="agendaForm" class="form-grid form-grid-3-col" style="align-items: end;">
                <div class="form-group" style="grid-column: 1 / 3;">
                    <label for="descEvento">Descripci√≥n / Tarea</label>
                    <input type="text" id="descEvento" class="form-control" required
                        placeholder="Ej: Vacunar Lote 001 con Newcastle">
                </div>
                <div class="form-group">
                    <label for="fechaEvento">Fecha Programada</label>
                    <input type="date" id="fechaEvento" class="form-control" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primario" style="width: 100%;">Agendar</button>
                </div>
            </form>

            <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid #eee;">

            <h3>Actividades Programadas</h3>
            <div class="tabla-responsive-wrapper">
                <table class="tabla-moderna">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripci√≥n</th>
                            <th>Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="tablaAgendaBody">
                    </tbody>
                </table>
            </div>
        </section>

        <section class="card" style="border: 1px solid #e74c3c;">
            <h2 style="color: #c0392b;">üõ†Ô∏è Zona de Respaldo y Restauraci√≥n</h2>
            <p style="color: #666; margin-bottom: 1rem;">
                Utiliza esta zona para descargar una copia completa de tu base de datos antes de que expire en Render,
                o para restaurar dicha copia en una base de datos nueva.
            </p>

            <div class="form-grid form-grid-2-col">
                <!-- EXPORTAR -->
                <div style="background: #fdf2f2; padding: 20px; border-radius: 8px;">
                    <h3>1. Exportar Datos</h3>
                    <p style="font-size: 0.9rem;">Descarga un archivo <code>.json</code> con toda la informaci√≥n actual.
                    </p>
                    <button id="btnExportar" class="btn btn-primario" style="background-color: #27ae60; width: 100%;">
                        üíæ Descargar Copia de Seguridad
                    </button>
                </div>

                <!-- IMPORTAR -->
                <div style="background: #fff8e1; padding: 20px; border-radius: 8px;">
                    <h3>2. Restaurar Datos</h3>
                    <p style="font-size: 0.9rem;">Sube el archivo <code>.json</code> para restaurar en una base de datos
                        <strong>NUEVA</strong>.</p>

                    <input type="file" id="backupInput" accept=".json" class="form-control"
                        style="margin-bottom: 10px;">

                    <button id="btnImportar" class="btn btn-peligro" style="width: 100%;">
                        ‚ö†Ô∏è Restaurar Backup
                    </button>
                </div>
            </div>
        </section>

        <footer>
            <p>¬© 2026 Granja Av√≠cola VincWill. Todos los derechos reservados.</p>
        </footer>
    </main>
    <script src="app.js"></script>
    <script src="configuracion.js"></script>
</body>

</html>